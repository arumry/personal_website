---
import Gallery from './Gallery.astro';
---

<section id="projects-section" class="w-full max-w-7xl mx-auto pb-5 pt-16 sm:pb-10 sm:pt-20 md:pt-24 md:pb-16 px-5 md:px-8 lg:px-12">
  <h2 class="text-zinc-500">&#47;&#47; Projects</h2>
  <div class="w-full flex flex-col mt-14 items-center">
    
    <!-- Kraken Project -->
    <div
      id="kraken-project"
      class="flex items-center w-full mb-28 flex-wrap px-5 md:px-8 lg:px-12 justify-center transition-all duration-1000 opacity-0 -translate-x-8 md:-translate-x-72"
    >
      <div class="w-full md:w-[40%] order-1 my-5 md:my-0 flex flex-col justify-start items-start">
        <h3 class="text-xs text-[#7132f5]">Work project</h3>
        <h3 class="text-white text-2xl mb-3">Kraken Digital Asset Exchange</h3>
        <div class="bg-primary-dark rounded-md w-full md:w-full h-fit text-white text-sm z-20 px-5 py-3 shadow-card">
          <span class="text-[#7132f5] text-base">&#123; "</span>content<span class="text-[#7132f5] text-base">": "</span>
          Authored foundational RFC and pioneered development of high-performance blockchain data ingestion system, enabling real-time analysis of UTXO and EVM-based chains. Engineered fault-tolerant data pipelines with sub-millisecond latency, empowering critical trading infrastructure and unlocking new analytical capabilities across Kraken's digital asset ecosystem.
          <span class="text-[#7132f5]">" &#125;</span>
        </div>
        <div class="flex gap-3 text-white w-full pr-3 mt-5 h-fit flex-wrap text-xs">
          <span>Rust</span>
          <span>Python</span>
          <span>TypeScript</span>
          <span>Kafka</span>
          <span>AWS</span>
          <span>Kubernetes</span>
          <span>PostgreSQL</span>
          <span>Redis</span>
        </div>
        <button
          id="kraken-gallery-btn"
          class="px-3 py-1 border mt-3 border-[#7132f5] text-[#7132f5] rounded text-sm hover:bg-[#7132f5] hover:text-primary"
          aria-label="View Kraken project gallery"
        >
          View more
        </button>
      </div>

      <div class="w-full md:w-[50%] order-2 relative group cursor-pointer rounded-lg overflow-hidden shadow-lg">
        <div class="absolute inset-0 bg-[#7132f5]/[35%] z-10 group-hover:hidden opacity-100 transition-all"></div>
        <div id="kraken-gallery-container">
          <Gallery
            galleryID="kraken-gallery"
            className="grayscale"
            images={[
              {
                largeURL: "/kraken/kraken-labs.webp",
                thumbnailURL: "/kraken/kraken-labs.webp",
                width: 776,
                height: 800,
              },
              {
                largeURL: "/kraken/kraken-labs-2.webp",
                width: 767,
                height: 800,
              },
              {
                largeURL: "/kraken/kraken-labs-3.webp",
                width: 776,
                height: 800,
              },
              {
                largeURL: "/kraken/kraken-transaction.png",
                width: 604,
                height: 800,
              },
              {
                largeURL: "/kraken/kraken-deposit.png",
                width: 604,
                height: 800,
              }
            ]}
          />
        </div>
      </div>
    </div>

    <!-- Cars.com Project -->
    <div
      id="cars-project"
      class="flex items-center justify-center w-full mb-28 flex-wrap px-5 md:px-8 lg:px-12 transition-all duration-1000 opacity-0 translate-x-8 md:translate-x-72"
    >
      <div class="w-full md:w-[50%] order-2 md:order-1 relative group cursor-pointer rounded-lg overflow-hidden shadow-lg">
        <div class="absolute inset-0 bg-fourth/[35%] z-10 group-hover:hidden opacity-100 transition-all "></div>
        <div id="cars-gallery-container">
          <Gallery
            galleryID="cars-gallery"
            className="grayscale"
            images={[
              {
                largeURL: "/car/cars-home.webp",
                thumbnailURL: "/car/cars-thumbnail.jpg",
                width: 776,
                height: 800,
              },
              {
                largeURL: "/car/cars-search.webp",
                width: 767,
                height: 800,
              },
              {
                largeURL: "/car/cars-vdp.webp",
                width: 853,
                height: 800,
              }
            ]}
          />
        </div>
      </div>

      <div class="w-full md:w-[40%] order-1 md:order-2 my-5 md:my-0 flex flex-col justify-start items-start md:items-end">
        <h3 class="text-xs text-[#C678DD] self-start md:self-end">Work project</h3>
        <h3 class="text-white text-2xl mb-3 self-start md:self-end">Cars.com</h3>
        <div class="bg-[#21252B] rounded-md w-full md:w-full h-fit text-white text-sm z-20 px-5 py-3 shadow-card">
          <span class="text-[#C678DD] text-base">&#123; "</span>content<span class="text-[#C678DD] text-base">": "</span> Accelerated inventory placement tenfold with Elixir and enhanced search speed by 30% using Elasticsearch and Redis, significantly improving user engagement metrics
          <span class="text-[#C678DD]">" &#125;</span>
        </div>
        <div class="flex gap-3 text-white w-fit self-start md:self-end mt-5 h-fit flex-wrap text-xs pl-0 md:pl-3">
          <span>Elixir</span>
          <span>Erlang/OTP</span>
          <span>GenStage</span>
          <span>Flow</span>
          <span>Elixir Phoenix Framework</span>
          <span>Elasticsearch</span>
          <span>Redis</span>
        </div>
        <button
          id="cars-gallery-btn"
          class="px-3 py-1 border mt-3 border-[#C678DD] text-[#C678DD] rounded text-sm hover:bg-[#C678DD] hover:text-[#282C34] self-start ml-0 md:ml-3"
          aria-label="View Cars.com project gallery"
        >
          View more
        </button>
      </div>
    </div>

    <!-- ZEFR Project -->
    <div
      id="zefr-project"
      class="flex items-center w-full mb-28 flex-wrap px-5 md:px-8 lg:px-12 justify-center transition-all duration-1000 opacity-0 -translate-x-8 md:-translate-x-72"
    >
      <div class="w-full md:w-[40%] order-1 my-5 md:my-0 flex flex-col justify-start items-start">
        <h3 class="text-xs text-[#D3C07B]">Work project</h3>
        <h3 class="text-white text-2xl mb-3">ZEFR</h3>
        <div class="bg-[#21252B] rounded-md w-full md:w-full h-fit text-white text-sm z-20 px-5 py-3 shadow-card">
          <span class="text-[#D3C07B] text-base">&#123; "</span>content<span class="text-[#D3C07B] text-base">": "</span> Enabled seamless collaboration and boosted campaign performance with an Influencer Management System, optimizing targeting and reducing costs
          <span class="text-[#D3C07B]">" &#125;</span>
        </div>
        <div class="flex gap-3 text-white w-full pr-3 mt-5 h-fit flex-wrap text-xs">
          <span>IMS</span>
          <span>Data analysis & extraction</span>
        </div>
        <button
          id="zefr-gallery-btn"
          class="px-3 py-1 border mt-3 border-[#D3C07B] text-[#D3C07B] rounded text-sm hover:bg-[#D3C07B] hover:text-[#282C34]"
          aria-label="View ZEFR project gallery"
        >
          View more
        </button>
      </div>

      <div class="w-full md:w-[50%] order-2 relative group cursor-pointer rounded-lg overflow-hidden shadow-lg">
        <div class="absolute inset-0 bg-tertiary/[35%] z-10 group-hover:hidden opacity-100 transition-all "></div>
        <div id="zefr-gallery-container">
          <Gallery
            galleryID="zefr-gallery"
            className="grayscale"
            images={[
              {
                largeURL: "/zefr.webp",
                thumbnailURL: "/zefr.png",
                width: 613,
                height: 752,
              }
            ]}
          />
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const krakenProject = document.getElementById('kraken-project');
  const carsProject = document.getElementById('cars-project');
  const zefrProject = document.getElementById('zefr-project');

  const krakenObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', '-translate-x-8', 'md:-translate-x-72');
        entry.target.classList.add('opacity-100', 'translate-x-0');
      }
    });
  });

  const carsObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', 'translate-x-8', 'md:translate-x-72');
        entry.target.classList.add('opacity-100', 'translate-x-0');
      }
    });
  });

  const zefrObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', '-translate-x-8', 'md:-translate-x-72');
        entry.target.classList.add('opacity-100', 'translate-x-0');
      }
    });
  });

  if (krakenProject) krakenObserver.observe(krakenProject);
  if (carsProject) carsObserver.observe(carsProject);
  if (zefrProject) zefrObserver.observe(zefrProject);

  function openGallery(galleryId: string, event?: Event) {
    // Prevent default behavior to avoid navigation in Safari
    if (event) {
      event.preventDefault();
      event.stopPropagation();
    }

    // Wait for PhotoSwipe to be ready before attempting to open gallery
    const attemptOpen = () => {
      const openFunc = (window as any)[`openGallery_${galleryId}`];
      if (openFunc && typeof openFunc === 'function') {
        openFunc();
      }
    };

    // Check if PhotoSwipe is ready, if not wait a bit
    if ((window as any).photoSwipeReady) {
      attemptOpen();
    } else {
      // Wait up to 1 second for PhotoSwipe to initialize
      let attempts = 0;
      const checkReady = () => {
        if ((window as any).photoSwipeReady || attempts > 10) {
          attemptOpen();
        } else {
          attempts++;
          setTimeout(checkReady, 100);
        }
      };
      checkReady();
    }
  }

  const krakenBtn = document.getElementById('kraken-gallery-btn');
  const carsBtn = document.getElementById('cars-gallery-btn');
  const zefrBtn = document.getElementById('zefr-gallery-btn');

  if (krakenBtn) {
    krakenBtn.addEventListener('click', (e) => openGallery('kraken-gallery', e));
  }
  if (carsBtn) {
    carsBtn.addEventListener('click', (e) => openGallery('cars-gallery', e));
  }
  if (zefrBtn) {
    zefrBtn.addEventListener('click', (e) => openGallery('zefr-gallery', e));
  }

  const krakenGallery = document.getElementById('kraken-gallery');
  const carsGallery = document.getElementById('cars-gallery');
  const zefrGallery = document.getElementById('zefr-gallery');

  if (krakenGallery) {
    krakenGallery.addEventListener('click', (e) => openGallery('kraken-gallery', e));
  }
  if (carsGallery) {
    carsGallery.addEventListener('click', (e) => openGallery('cars-gallery', e));
  }
  if (zefrGallery) {
    zefrGallery.addEventListener('click', (e) => openGallery('zefr-gallery', e));
  }
</script>
